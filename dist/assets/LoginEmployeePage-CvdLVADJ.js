import{u as f,a as b,s as h,j as a,r as u}from"./index-qf8s-zRF.js";import{a as x,b as j,C as k,L as w,I as C,A as N,F as v}from"./FormInput-DJa-sUSO.js";import{B as L}from"./button-C8zhA43l.js";import{C as S}from"./calendar-DIXATJyc.js";import{T as E}from"./TextField-CC0xftzg.js";import{a as I}from"./apiClient-BmXS3_vS.js";import{F as _}from"./fingerprint-DJyXRt3r.js";import"./pdfjs-BzSgQdvw.js";import"./index-NIGUFBhG.js";function F(){const o=f(),{login:r,setToken:s}=b();return{loginEmployee:async(l,i,m)=>{try{const e=await x(l,i,m);if(e?.token){const t={id:e.employee.id,email:"",token:e.token,name:e.employee.name,role:"Employee",position:"",department:"",phone_number:e.employee.phone_number??"",dob:e.employee.dob,gender:e.employee.gender,employee_number:e.employee.employee_number,company:e.employee.company_id?{id:e.employee.company_id,name:e.employee.company_name}:null};r(e.token,t),s(e.token),localStorage.setItem("batches",JSON.stringify(e.batches??[])),h({title:"Login Berhasil",text:`Selamat datang kembali, ${e.employee.name}!`,icon:"success",timer:1500,showConfirmButton:!1,onClose:()=>o("/")})}else throw new Error("Token tidak ditemukan dalam response")}catch(e){let t=e?.meta?.message||e?.message||"Terjadi kesalahan";h({title:"Login Gagal",text:t,icon:"error"})}}}}function T({control:o}){return a.jsx(j,{control:o,name:"dob",label:"Tanggal Lahir",placeholder:"Pilih tanggal lahir",type:"date",rules:{required:"Tanggal lahir wajib diisi"},leftIcon:a.jsx(S,{className:"w-5 h-5"})})}const A=async o=>{const r=o?`/company-list?search=${encodeURIComponent(o)}`:"/company-list",s=await I("get",r);return Array.isArray(s.data)?s.data:[]};function y(o){const[r,s]=u.useState([]),[n,l]=u.useState(!1),[i,m]=u.useState(null);return u.useEffect(()=>{if(!o||o.length<2){s([]);return}(async()=>{try{l(!0);const t=await A(o);console.log("Companies API result:",t),s(t??[])}catch(t){m(t.message??"Gagal memuat data perusahaan"),s([])}finally{l(!1)}})()},[o]),{companies:r,loading:n,error:i}}function P({control:o,name:r,label:s,placeholder:n="Ketik nama perusahaan...",rules:l}){const[i,m]=u.useState(""),[e,t]=u.useState(!1),{companies:p,loading:d}=y(i);return a.jsx(k,{name:r,control:o,rules:l,render:({field:g})=>a.jsxs("div",{className:"space-y-1 relative",children:[a.jsx(w,{children:s}),a.jsx(C,{value:i,placeholder:n,onChange:c=>{m(c.target.value),t(!0),g.onChange("")},onFocus:()=>i&&t(!0)}),e&&i&&a.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-40 overflow-auto",children:[d&&a.jsx("div",{className:"p-2 text-sm text-gray-500",children:"Memuat..."}),!d&&p&&p.length===0&&a.jsx("div",{className:"p-2 text-sm text-gray-500",children:"Tidak ada hasil"}),p&&p.map(c=>a.jsx("div",{className:"p-2 text-sm hover:bg-gray-100 cursor-pointer",onClick:()=>{g.onChange(c.code),m(c.name),t(!1)},children:c.name},c.code))]})]})})}function J(){const{loginEmployee:o}=F(),{loading:r}=y(),s=n=>o(n.nik,n.dob,n.company_code);return a.jsx(N,{title:"Login",subtitle:"Masukkan NIK, Tanggal Lahir dan Perusahaan untuk masuk.",children:a.jsx(v,{defaultValues:{nik:"3171012300050000",dob:"1987-09-10",company_code:"NA730"},onSubmit:s,children:({control:n})=>a.jsxs("div",{className:"space-y-4",children:[a.jsx(E,{control:n,name:"nik",label:"NIK",placeholder:"Masukkan NIK",rules:{required:"NIK wajib diisi"},leftIcon:a.jsx(_,{className:"w-5 h-5"})}),a.jsx(T,{control:n}),a.jsx(P,{control:n,name:"company_code",label:"Perusahaan",rules:{required:"Perusahaan wajib dipilih"}}),a.jsx(L,{type:"submit",className:"w-full bg-primary text-primary-content hover:bg-primary-focus",disabled:r,children:"Masuk"})]})})})}export{J as default};
