import{u as b,a as f,s as h,j as a,r as u}from"./index-BIIL7VVf.js";import{a as x,b as j,C as k,L as w,I as C,A as N,F as v}from"./FormInput-AxLJgXeE.js";import{B as L}from"./button-BlcJd5pQ.js";import{C as S}from"./calendar-BRCx1wEa.js";import{T as E}from"./TextField-CEQKxWXa.js";import{a as I}from"./apiClient-C4E4e5VJ.js";import{F as _}from"./fingerprint-C0qeCUNx.js";import"./pdfjs-DdtK18WL.js";import"./index-C0RmN517.js";function F(){const n=b(),{login:r,setToken:o}=f();return{loginEmployee:async(l,i,m)=>{try{const e=await x(l,i,m);if(e?.token){const t={id:e.employee.id,email:"",token:e.token,name:e.employee.name,role:"Employee",position:"",department:"",phone_number:e.employee.phone_number??"",dob:e.employee.dob,gender:e.employee.gender,employee_number:e.employee.employee_number,company:e.employee.company_id?{id:e.employee.company_id,name:e.employee.company_name}:null};r(e.token,t),o(e.token),localStorage.setItem("batches",JSON.stringify(e.batches??[])),h({title:"Login Berhasil",text:`Selamat datang kembali, ${e.employee.name}!`,icon:"success",timer:1500,showConfirmButton:!1,onClose:()=>n("/")})}else throw new Error("Token tidak ditemukan dalam response")}catch(e){let t=e?.meta?.message||e?.message||"Terjadi kesalahan";h({title:"Login Gagal",text:t,icon:"error"})}}}}function T({control:n}){return a.jsx(j,{control:n,name:"dob",label:"Tanggal Lahir",placeholder:"Pilih tanggal lahir",type:"date",rules:{required:"Tanggal lahir wajib diisi"},leftIcon:a.jsx(S,{className:"w-5 h-5"})})}const A=async n=>{const r=n?`/company-list?search=${encodeURIComponent(n)}`:"/company-list",o=await I("get",r);return Array.isArray(o.data)?o.data:[]};function y(n){const[r,o]=u.useState([]),[s,l]=u.useState(!1),[i,m]=u.useState(null);return u.useEffect(()=>{if(!n||n.length<2){o([]);return}(async()=>{try{l(!0);const t=await A(n);console.log("Companies API result:",t),o(t??[])}catch(t){m(t.message??"Gagal memuat data perusahaan"),o([])}finally{l(!1)}})()},[n]),{companies:r,loading:s,error:i}}function P({control:n,name:r,label:o,placeholder:s="Ketik nama perusahaan...",rules:l}){const[i,m]=u.useState(""),[e,t]=u.useState(!1),{companies:p,loading:d}=y(i);return a.jsx(k,{name:r,control:n,rules:l,render:({field:g})=>a.jsxs("div",{className:"space-y-1 relative",children:[a.jsx(w,{children:o}),a.jsx(C,{value:i,placeholder:s,onChange:c=>{m(c.target.value),t(!0),g.onChange("")},onFocus:()=>i&&t(!0)}),e&&i&&a.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-white border rounded shadow max-h-40 overflow-auto",children:[d&&a.jsx("div",{className:"p-2 text-sm text-base-content",children:"Memuat..."}),!d&&p&&p.length===0&&a.jsx("div",{className:"p-2 text-sm text-base-content",children:"Tidak ada hasil"}),p&&p.map(c=>a.jsx("div",{className:"p-2 text-sm hover:bg-gray-100 cursor-pointer",onClick:()=>{g.onChange(c.code),m(c.name),t(!1)},children:c.name},c.code))]})]})})}function J(){const{loginEmployee:n}=F(),{loading:r}=y(),o=s=>n(s.nik,s.dob,s.company_code);return a.jsx(N,{title:"Login",subtitle:"Masukkan NIK, Tanggal Lahir dan Perusahaan untuk masuk.",children:a.jsx(v,{defaultValues:{nik:"3175098773",dob:"1995-06-25",company_code:""},onSubmit:o,children:({control:s})=>a.jsxs("div",{className:"space-y-4",children:[a.jsx(E,{control:s,name:"nik",label:"NIK",placeholder:"Masukkan NIK",rules:{required:"NIK wajib diisi"},leftIcon:a.jsx(_,{className:"w-5 h-5"})}),a.jsx(T,{control:s}),a.jsx(P,{control:s,name:"company_code",label:"Perusahaan",rules:{required:"Perusahaan wajib dipilih"}}),a.jsx(L,{type:"submit",className:"w-full bg-primary text-primary-content hover:bg-primary-focus",disabled:r,children:"Masuk"})]})})})}export{J as default};
